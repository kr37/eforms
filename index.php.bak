<html>
<head>
<style>
    td    { border: 1px solid gray; padding: 0 .3em; }
    table { border-collapse: collapse; }
</style>
</head>
<body>
<?php
include('../wp-config.php');
$formNum = $_GET['form'];
echo "Hi there! $formNum";

$mysqli = new mysqli('localhost', DB_USER, DB_PASSWORD, DB_NAME);

// Get the form
$form = $mysqli->query("SELECT * FROM VPh_fsq_form WHERE id=$formNum");
$row = $form->fetch_assoc(); {
    // parse out the mcq array (multiple-choice-questions?)
    $mcqAnswers = unserialize($row['mcq']); 
    //foreach($mcqAnswers as $key => $answer) echo $answer['settings']['options'][0]['label'];
    $row['mcq'] = print_r($mcqAnswers,true);
}
echo "<h2>$row[name]</h2>";

// Show the signups - Most recent first
echo "<h2>Most Recent</h2>";
$count = 0; $first = 1; $inPerson = 0;
$result = $mysqli->query("SELECT f_name,l_name,email,mcq,amount,`VPh_fsq_payment`.`date` FROM `VPh_fsq_payment` LEFT JOIN VPh_fsq_data ON `VPh_fsq_payment`.`data_id`=`VPh_fsq_data`.`id` WHERE `VPh_fsq_payment`.`form_id`=$formNum ORDER BY `VPh_fsq_payment`.`date` DESC");
echo "<table>";
while ($row = $result->fetch_assoc()) {
    if ($first) {
        $first = 0;
        echo "<th>";
        foreach ($row as $key => $value)
            echo "<td><b>$key</b></td>";
        echo "</th>";
    }

    $count++;
    echo "<tr><td>$count</td>";
    // parse out the mcq array (multiple-choice-questions?)
    $mcqArray = unserialize($row['mcq']); 
    $row['mcq'] = '';
    foreach ($mcqArray as $key => $question){
        $row['mcq'] .= $mcqAnswers[$key]['settings']['options'][$question['options'][0]]['label'] . '<br>';
        if (strpos($row['mcq'], 'person')) $inPerson++;
    }
    //Display
    foreach ($row as $key => $value)
        echo "<td>$value</td>";
    echo "</tr>";
}
echo "</table>";
echo "$inPerson in person.";


// Show the signups - Alphabetical
echo "<h2>Alphabetical</h2>";
$count = 0; $first = 1; $inPerson = 0;
$result = $mysqli->query("SELECT f_name,l_name,email,mcq,amount,`VPh_fsq_payment`.`date` FROM `VPh_fsq_payment` LEFT JOIN VPh_fsq_data ON `VPh_fsq_payment`.`data_id`=`VPh_fsq_data`.`id` WHERE `VPh_fsq_payment`.`form_id`=$formNum ORDER BY f_name ASC,l_name ASC");
echo "<table>";
while ($row = $result->fetch_assoc()) {
    if ($first) {
        $first = 0;
        echo "<th>";
        foreach ($row as $key => $value)
            echo "<td><b>$key</b></td>";
        echo "</th>";
    }

    $count++;
    echo "<tr><td>$count</td>";
    // parse out the mcq array (multiple-choice-questions?)
    $mcqArray = unserialize($row['mcq']); 
    $row['mcq'] = '';
    foreach ($mcqArray as $key => $question){
        $row['mcq'] .= $mcqAnswers[$key]['settings']['options'][$question['options'][0]]['label'] . '<br> ';
        if (strpos($row['mcq'], 'person')) $inPerson++;
    }
    //Display
    foreach ($row as $key => $value)
        echo "<td>$value</td>";
    echo "</tr>";
}
echo "</table>";
echo "$inPerson in person.";


// Show the form
echo "<pre>\n";
$form = $mysqli->query("SELECT * FROM VPh_fsq_form WHERE id=$formNum");
while ($row = $form->fetch_assoc()) {
    // parse out the mcq array (multiple-choice-questions?)
    $mcqAnswers = unserialize($row['mcq']); 
    foreach($mcqAnswers as $key => $answer) {
        echo $answer['settings']['options'][0]['label']."\n";
    }
    $row['mcq'] = print_r($mcqAnswers,true);
}
echo "</pre>\n";
echo "<p>";
foreach ($row as $key => $value)
    echo "<span style='color:red;'><b>$key => </b></span>$value<br>";
echo "</p>";
?>
</body>
</html>
